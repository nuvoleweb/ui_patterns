<?php

/**
 * @file
 * Contains module file.
 */

use Drupal\ui_patterns\Element\PatternContext;
use Drupal\Core\Layout\LayoutDefinition;
use Drupal\ui_patterns\UiPatterns;
use Drupal\Core\Entity\Display\EntityViewDisplayInterface;
use Drupal\Core\Entity\EntityInterface;
use Drupal\field_layout\Display\EntityDisplayWithLayoutInterface;

/**
 * Implements hook_layout_alter().
 */
function ui_patterns_layouts_layout_alter(&$definitions) {
  /** @var \Drupal\ui_patterns\Definition\PatternDefinition[] $pattern_definitions */

  /** @var \Drupal\sdc\ComponentPluginManager $plugin_manager */
  $plugin_manager = \Drupal::service('plugin.manager.sdc');
  /** @var \Drupal\sdc\Component\ComponentMetadata[] $components */
  $components = $plugin_manager->getDefinitions();
  foreach ($components as $component) {
    $definition = [
      'label' => $component['name'] ?? $component['id'],
      'category' => 'sdc',
      'provider' => $component['provider'],
      'class' => '\Drupal\ui_patterns_layouts\Plugin\Layout\PatternLayout',
      'id' => $component['id'],
    ];
    if (isset($component['slots'])) {
      foreach ($component['slots'] as $slot_id => $slot) {
        $definition['regions'][$slot_id]['label'] = $slot['title'];
      }
    }

    $definitions['sdc_' . $component['id']] = new LayoutDefinition($definition);
  }
}
